<!DOCTYPE html>
<html>
<head>
Â  <base target="_top">
Â  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
Â  <title>ä¿é¤Šå“å¿«é€Ÿå»ºæª”å·¥å…·</title>
Â  <style>
    /* ä¿æŒ CSS æ¨£å¼ä¸è®Š */
Â  Â  body {
Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
Â  background-color: #f4f6f8; 
Â  margin: 0;
Â  padding: 0;
}

.container {
Â  max-width: 600px;
Â  margin: 0 auto;
Â  padding: 20px;
}

.header {
Â  text-align: center;
Â  color: #007bff; 
Â  margin-bottom: 30px;
Â  font-size: 1.8em;
}

/* è¼¸å…¥ç¾¤çµ„æ¨£å¼ */
.input-group {
Â  margin-bottom: 15px;
}

label {
Â  display: block;
Â  margin-bottom: 5px;
Â  font-weight: bold;
Â  color: #333;
Â  font-size: 1.1em;
}

input[type="text"], 
input[type="date"], 
select, 
textarea {
Â  width: 100%;
Â  padding: 12px;
Â  margin-top: 5px;
Â  box-sizing: border-box;
Â  border: 1px solid #ccc;
Â  border-radius: 8px;
Â  font-size: 1.1em; 
}

textarea {
Â  resize: vertical;
}

/* æŒ‰éˆ•æ¨£å¼ï¼šé©åˆå–®æ‰‹é»æ“Šçš„å¤§å°ºå¯¸ */
.action-btn {
Â  width: 100%;
Â  padding: 15px;
Â  border: none;
Â  border-radius: 10px;
Â  font-size: 1.2em;
Â  font-weight: bold;
Â  cursor: pointer;
Â  margin-top: 15px;
Â  transition: background-color 0.3s;
}

.detect-btn {
Â  background-color: #ffc107; 
Â  color: #333;
}

.submit-btn {
Â  background-color: #28a745; 
Â  color: white;
Â  margin-bottom: 50px; 
}

.detect-btn:hover { background-color: #e0a800; }
.submit-btn:hover { background-color: #1e7e34; }

/* éš±è—åŸç”Ÿæª”æ¡ˆä¸Šå‚³æŒ‰éˆ•ï¼Œä½¿ç”¨å®¢è£½åŒ–çš„ Label */
#photoFile {
Â  display: none; 
}

.file-label {
Â  display: block;
Â  text-align: center;
Â  padding: 20px;
Â  background-color: #e9ecef; 
Â  border: 2px dashed #adb5bd;
Â  border-radius: 10px;
Â  color: #6c757d;
Â  font-weight: bold;
Â  cursor: pointer;
Â  font-size: 1.1em;
Â  margin-bottom: 10px;
}

.status-msg {
Â  margin-top: 10px;
Â  padding: 10px;
Â  text-align: center;
Â  font-weight: bold;
}
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <h1 class="header">ğŸ“¸ å¿«é€Ÿå»ºæª”</h1>
Â  Â  Â  Â  <form id="cosmeticForm"> 
Â  Â  Â  
Â  Â  Â  <section class="photo-section">
Â  Â  Â  Â  <label for="photoFile" class="file-label">é»æ“Šæ‹ç…§æˆ–ä¸Šå‚³åœ–ç‰‡</label>
Â  Â  Â  Â  <input type="file" id="photoFile" name="photoFile" accept="image/*" capture="environment" required>
Â  Â  Â  Â  <button type="button" id="aiDetectBtn" class="action-btn detect-btn">ğŸ¤– é›²ç«¯ AI è¾¨è­˜</button>
Â  Â  Â  Â  <div id="aiStatus" class="status-msg"></div>
Â  Â  Â  </section>

Â  Â  Â  <section class="info-section">
Â  Â  Â  Â  <h2>ç”¢å“è³‡è¨Š</h2>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="brand">å“ç‰Œ *</label>
Â  Â  Â  Â  Â  <input type="text" id="brand" name="brand" placeholder="ä¾‹å¦‚ï¼šSK-II" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="name">å“å *</label>
Â  Â  Â  Â  Â  <input type="text" id="name" name="name" placeholder="ä¾‹å¦‚ï¼šé’æ˜¥éœ²" required>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="category">åˆ†é¡</label>
Â  Â  Â  Â  Â  <select id="category" name="category">
Â  Â  Â  Â  Â  Â  <option value="">è«‹é¸æ“‡</option>
Â  Â  Â  Â  Â  Â  <option value="ç²¾è¯æ¶²">ç²¾è¯æ¶²</option>
Â  Â  Â  Â  Â  Â  <option value="åŒ–å¦æ°´">åŒ–å¦æ°´</option>
Â  Â  Â  Â  Â  Â  <option value="ä¹³æ¶²/é¢éœœ">ä¹³æ¶²/é¢éœœ</option>
Â  Â  Â  Â  Â  Â  <option value="çœ¼éœœ">çœ¼éœœ</option>
Â  Â  Â  Â  Â  Â  <option value="è©¦ç”¨å“">è©¦ç”¨å“</option>
Â  Â  Â  Â  Â  Â  <option value="å…¶ä»–">å…¶ä»–</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="expiryDate">æ•ˆæœŸ</label>
Â  Â  Â  Â  Â  <input type="date" id="expiryDate" name="expiryDate">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="openDate">é–‹å°æ—¥</label> 
Â  Â  Â  Â  Â  <input type="date" id="openDate" name="openDate">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="notes">å‚™è¨»</label>
Â  Â  Â  Â  Â  <textarea id="notes" name="notes" rows="3" placeholder="ä¾‹å¦‚ï¼šé©ç”¨å†¬å­£ä¹¾è‚Œï¼Œå·²é€å‡ºå…¬é—œå“"></textarea>
Â  Â  Â  Â  </div>
Â  Â  Â  </section>
Â  Â  Â  
Â  Â  Â  <button type="submit" id="submitBtn" class="action-btn submit-btn">ğŸš€ å„²å­˜ä¸¦é€å‡º</button>
Â  Â  Â  <div id="loadingStatus" class="status-msg"></div>
Â  Â  </form>
Â  </div>
Â  
Â  <div style="text-align: center; margin-top: 20px;">
Â  Â  Â  Â  <a href="https://script.google.com/macros/s/AKfycbyFfj4pKcDgA1AMEax5U3dt4qLZnxY9UUnmE7zyzjtAY65GnJWzWcthh2sfD4RizewV/exec?page=list" style="color:#007bff; text-decoration: none; font-weight: bold; font-size: 1.1em;">
Â  Â  Â  Â  æŸ¥çœ‹æ‰€æœ‰ç”¢å“æ¸…å–®
Â  Â  </a>
    </div>

Â  Â  <script src="https://apis.google.com/js/api.js"></script> 
Â  <script>
    // VVVV é—œéµä¿®æ­£ï¼šå®šç¾© Web App URL VVVV
    // é›–ç„¶å¤–éƒ¨åŸ·è¡Œä¸éœ€è¦é€™å€‹ï¼Œä½†å®šç¾©ä¸€å€‹è®Šæ•¸æœ‰åˆ©æ–¼ç¶­è­·
    const GAS_WEB_APP_URL = '[æ‚¨çš„ Web App éƒ¨ç½² URL]'; 
    // ^^^^ é—œéµä¿®æ­£ ^^^^


document.getElementById('cosmeticForm').addEventListener('submit', function(e) {
Â  e.preventDefault(); // é˜»æ­¢è¡¨å–®åŸç”Ÿæäº¤è¡Œç‚º

Â  const form = e.target;
Â  const submitBtn = document.getElementById('submitBtn');
Â  const loadingStatus = document.getElementById('loadingStatus');

Â  submitBtn.disabled = true;
Â  loadingStatus.innerHTML = 'æ­£åœ¨è™•ç†ä¸¦ä¸Šå‚³ä¸­... è«‹ç¨å€™';
Â  loadingStatus.style.color = '#007bff';

Â  // å‰µå»º FormData ç‰©ä»¶ä¾†è™•ç†æª”æ¡ˆå’Œæ¬„ä½è³‡æ–™
Â  const formData = new FormData(form);
Â  
Â  // VVVV é—œéµï¼šå› ç‚ºæ˜¯å¤–éƒ¨åŸ·è¡Œï¼Œç›´æ¥ä½¿ç”¨ google.script.runï¼ŒApps Script æœƒè‡ªå‹•è™•ç†æª”æ¡ˆä¸Šå‚³ VVVV
Â  google.script.run
Â  Â  Â  .withSuccessHandler(onSuccess)
Â  Â  Â  .withFailureHandler(onFailure)
Â  Â  Â  .processFormSubmit(formData);
Â  // ^^^^ é—œéµ ^^^^

});

// æˆåŠŸè™•ç†å¾Œçš„è™•ç†å™¨
function onSuccess(response) {
Â  const loadingStatus = document.getElementById('loadingStatus');
Â  document.getElementById('submitBtn').disabled = false;
Â  
Â  // æ¸…ç©ºè¡¨å–®
Â  document.getElementById('cosmeticForm').reset();
Â  
Â  // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
Â  loadingStatus.innerHTML = `âœ… ${response.message || 'å»ºæª”æˆåŠŸï¼'}`;
Â  loadingStatus.style.color = '#28a745'; 
Â  
Â  // 3ç§’å¾Œæ¸…é™¤è¨Šæ¯
Â  setTimeout(() => loadingStatus.innerHTML = '', 3000);
}

// å¤±æ•—è™•ç†å¾Œçš„è™•ç†å™¨
function onFailure(error) {
Â  const loadingStatus = document.getElementById('loadingStatus');
Â  document.getElementById('submitBtn').disabled = false;

Â  loadingStatus.innerHTML = `âŒ éŒ¯èª¤ï¼š${error.message || 'å»ºæª”å¤±æ•—ã€‚'}`;
Â  loadingStatus.style.color = '#dc3545';
Â  console.error("GAS åŸ·è¡Œå¤±æ•—è©³æƒ…ï¼š", error);
}


// --- åœ–ç‰‡é è¦½åŠŸèƒ½ ---
document.getElementById('photoFile').addEventListener('change', function() {
Â  Â  const fileLabel = document.querySelector('.file-label');
Â  Â  const file = this.files[0];
Â  Â  if (file) {
Â  Â  Â  Â  fileLabel.textContent = `å·²é¸å–ï¼š${file.name}`;
Â  Â  } else {
Â  Â  Â  Â  fileLabel.textContent = 'é»æ“Šæ‹ç…§æˆ–ä¸Šå‚³åœ–ç‰‡';
Â  Â  }
});

// --- AI è¾¨è­˜æŒ‰éˆ•åŠŸèƒ½ ---
document.getElementById('aiDetectBtn').addEventListener('click', function() {
    // ... (ä¿ç•™ AI é‚è¼¯ï¼Œèˆ‡æäº¤é‚è¼¯é¡ä¼¼ï¼Œä¸éœ€è¦ setUploadMode)
Â  Â  const aiStatus = document.getElementById('aiStatus');
Â  Â  const photoFile = document.getElementById('photoFile');

Â  Â  if (photoFile.files.length === 0) {
Â  Â  Â  Â  aiStatus.innerHTML = 'è«‹å…ˆé¸å–ä¸€å¼µç…§ç‰‡ï¼';
Â  Â  Â  Â  aiStatus.style.color = '#ffc107';
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  const file = photoFile.files[0];
Â  Â  const reader = new FileReader();

Â  Â  aiStatus.innerHTML = 'æ­£åœ¨é€²è¡Œ AI è¾¨è­˜...';
Â  Â  aiStatus.style.color = '#007bff';
Â  Â  
Â  Â  // è®€å–æª”æ¡ˆç‚º Base64 å­—ä¸²
Â  Â  reader.onload = function(e) {
Â  Â  Â  Â  const base64Data = e.target.result.split(',')[1];
Â  Â  Â  Â  
Â  Â  Â  Â  // å‘¼å« GAS ä¼ºæœå™¨ç«¯å‡½å¼
Â  Â  Â  Â  google.script.run
Â  Â  Â  Â  Â  Â  .withSuccessHandler(onAiSuccess)
Â  Â  Â  Â  Â  Â  .withFailureHandler(onAiFailure)
Â  Â  Â  Â  Â  Â  .callAIDetection(base64Data);
Â  Â  };
Â  Â  
Â  Â  reader.onerror = function() {
Â  Â  Â  Â  onAiFailure(new Error("ç„¡æ³•è®€å–åœ–ç‰‡æª”æ¡ˆã€‚"));
Â  Â  };

Â  Â  reader.readAsDataURL(file); 
});

// AI è¾¨è­˜æˆåŠŸè™•ç†å™¨
function onAiSuccess(result) {
Â  Â  const aiStatus = document.getElementById('aiStatus');
Â  Â  
Â  Â  if (result.error) {
Â  Â  Â  Â  aiStatus.innerHTML = `âŒ è¾¨è­˜å¤±æ•—: ${result.error}`;
Â  Â  Â  Â  aiStatus.style.color = '#dc3545';
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // è‡ªå‹•å¡«å…¥æ¬„ä½
Â  Â  if (result.brand) {
Â  Â  Â  Â  document.getElementById('brand').value = result.brand;
Â  Â  }
Â  Â  if (result.name) {
Â  Â  Â  Â  document.getElementById('name').value = result.name;
Â  Â  }

Â  Â  aiStatus.innerHTML = `âœ… AI è¾¨è­˜å®Œæˆï¼å“ç‰Œ: ${result.brand || 'ç„¡'}ï¼Œå“å: ${result.name || 'ç„¡'}`;
Â  Â  aiStatus.style.color = '#28a745';
Â  Â  setTimeout(() => aiStatus.innerHTML = '', 5000);
}

// AI è¾¨è­˜å¤±æ•—è™•ç†å™¨
function onAiFailure(error) {
Â  Â  const aiStatus = document.getElementById('aiStatus');
Â  Â  aiStatus.innerHTML = `âŒ ç³»çµ±éŒ¯èª¤ï¼š${error.message || 'AI è¾¨è­˜è™•ç†ç•°å¸¸ã€‚'}`;
Â  Â  aiStatus.style.color = '#dc3545';
}
Â  </script>
</body>
</html>
