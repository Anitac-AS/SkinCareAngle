<!doctype html>
.danger{background:#fee;color:#a00}
.warn{background:#fff5e6;color:#a55}
.ok{background:#eef7ff;color:#156}
</style>
<body>
<div class="wrap">
<h3>保養品總覽</h3>
<div style="margin:8px 0">
<input id="q" placeholder="搜尋 品名/品牌/條碼"/>
<select id="status">
<option value="">全部狀態</option>
<option>未開封</option><option>使用中</option><option>已用完</option><option>過期</option>
</select>
<button id="btn">查詢</button>
</div>
<div class="grid" id="list"></div>
</div>
<script>
const GAS_LIST = 'https://script.google.com/macros/s/XXXXXXXXXXXXXXXX/exec'; // ← 換成你的 Apps Script Web App URL（同一個）


document.getElementById('btn').onclick = load;
window.addEventListener('load', load);


async function load(){
const q = document.getElementById('q').value.trim();
const status = document.getElementById('status').value;
const url = new URL(GAS_LIST);
if (q) url.searchParams.set('q', q);
if (status) url.searchParams.set('status', status);
const res = await fetch(url);
const json = await res.json();
const box = document.getElementById('list');
box.innerHTML = '';
json.data.forEach(item => box.appendChild(render(item)));
}


function render(it){
const d = daysToExpiry(it.expiry_date);
const badge = document.createElement('div');
badge.className = 'badge ' + (isNaN(d) ? 'ok' : d<0 ? 'danger' : d<=30 ? 'warn' : 'ok');
badge.textContent = isNaN(d) ? '無效期' : d<0 ? `已過期 ${-d} 天` : `D-${d}`;


const img = document.createElement('img');
img.src = it.image_url || 'https://dummyimage.com/600x400/eeeeee/aaaaaa&text=%20';
img.alt = it.name || '';


const div = document.createElement('div');
div.className = 'card';
div.innerHTML = `
<div>${badge.outerHTML}</div>
<div style="margin:8px 0"><strong>${escapeHtml(it.name||'(未命名)')}</strong>${it.brand? ' / '+escapeHtml(it.brand):''}</div>
<div class="meta">分類：${escapeHtml(it.category||'-')}｜條碼：${escapeHtml(it.barcode||'-')}</div>
<div class="meta">效期：${escapeHtml(it.expiry_date||'-')}｜狀態：${escapeHtml(it.status||'-')}</div>
`;
div.prepend(img);
return div;
}


function daysToExpiry(dateStr){
if (!dateStr) return NaN;
const d = new Date(dateStr + 'T00:00:00');
const ms = d - new Date();
return Math.floor(ms / (1000*60*60*24));
}
function escapeHtml(s){return (s||'').replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]))}
</script>
</body>
